<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Writer's Workspace</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- TINYMCE SCRIPT -->
    <script src="https://cdn.tiny.cloud/1/tth7kpsyc53fbzgd6zz6kz2huhefefwxbts007tf2zx7ab4t/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
    <style>
        :root {
            --bg-dark: #1e293b;
            --bg-nav: #111827;
            --panel-bg: #ffffff;
            --border-color: #334155;
            --primary-color: #3f51b5;
            --text-light: #f8fafc;
            --text-dark: #1e293b;
            --text-secondary: #94a3b8;
            --accent-pink: #ec4899;
            --highlight-color: #fff59d;
        }
        *, *::before, *::after { box-sizing: border-box; }
        html, body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            background-color: var(--bg-dark);
            color: var(--text-light);
        }
        .app-wrapper {
            display: flex;
            height: 100vh;
        }

        /* --- Navigation Sidebar --- */
        .main-nav {
            width: 250px;
            flex-shrink: 0;
            background-color: var(--bg-nav);
            padding: 24px;
            display: flex;
            flex-direction: column;
        }
        .main-nav .logo {
            width: 150px;
            margin-bottom: 24px;
        }
        .nav-dropdown {
            width: 100%;
            padding: 12px 16px;
            border-radius: 8px;
            background-color: var(--bg-dark);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            font-weight: 500;
            margin-bottom: 24px;
        }
        .nav-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .nav-list li a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 8px;
            text-decoration: none;
            color: var(--text-secondary);
            font-weight: 500;
            margin-bottom: 8px;
            transition: background-color 0.2s;
        }
        .nav-list li a:hover {
            background-color: #374151;
        }
        .nav-list li a.active {
            background-color: var(--primary-color);
            color: var(--text-light);
        }
        .nav-list li a.active svg {
            color: var(--text-light);
        }
        .nav-list svg {
            width: 20px;
            height: 20px;
        }
        .nav-footer {
            margin-top: auto;
        }
        .version-info {
            padding: 8px;
            background-color: var(--bg-dark);
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            color: var(--text-secondary);
            text-align: center;
        }

        /* --- Main Content Area --- */
        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            padding: 32px;
        }
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            flex-shrink: 0;
        }
        .content-header h2 {
            margin: 0;
            font-size: 36px;
        }
        .search-assignments {
            padding: 12px 16px;
            border-radius: 20px;
            background-color: #334155;
            border: 1px solid var(--border-color);
            color: var(--text-light);
            width: 300px;
        }
        
        /* --- Workspace Styles --- */
        .workspace-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-shrink: 0;
        }
        .tab-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            background-color: transparent;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            color: var(--text-secondary);
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .tab-btn:hover {
            background-color: #334155;
        }
        .tab-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        .tab-btn.active svg {
            color: white;
        }
        .tab-btn svg {
            width: 20px;
            height: 20px;
        }
        .workspace-container {
            flex-grow: 1;
            display: flex;
            gap: 16px;
            overflow: hidden;
        }
        .workspace-pane {
            flex: 1;
            background-color: var(--panel-bg);
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            color: var(--text-dark);
        }
        .workspace-pane.hidden {
            display: none;
        }
        .pane-header {
            padding: 16px 24px;
            border-bottom: 1px solid #e2e8f0;
            font-weight: 500;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }
        .pane-header svg {
            width: 24px;
            height: 24px;
            color: var(--primary-color);
        }
        .pane-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 24px;
            font-size: 16px;
            line-height: 1.6;
        }
        /* TinyMCE content area needs to fill the space */
        .pane-content.editor-pane {
            padding: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .tox-tinymce {
            border-radius: 0 0 16px 16px !important;
            border-width: 0 !important;
            flex-grow: 1;
        }

        .placeholder-content {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            color: var(--text-secondary);
        }
        
        .library-text-container h1 { font-size: 28px; margin-top: 0; margin-bottom: 8px; color: var(--text-dark); }
        .library-text-container h2 { font-size: 18px; font-weight: 400; color: var(--text-secondary); margin-top: 0; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 1px solid #e2e8f0; }
        .library-text-container p { margin-bottom: 1.5em; color: var(--text-dark); }
        .library-text-container mark { background-color: var(--highlight-color); padding: 2px 0; }
        .library-footer { padding: 16px 24px; border-top: 1px solid #e2e8f0; }
        .library-footer button {
            width: 100%;
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            text-transform: none;
        }

        /* --- Modal Styles --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        .modal-container {
            background-color: var(--panel-bg);
            color: var(--text-dark);
            border-radius: 16px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .modal-header {
            padding: 16px 24px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-header h3 {
            margin: 0;
            font-size: 20px;
        }
        .modal-close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
        }
        .modal-content {
            padding: 24px;
            overflow-y: auto;
        }
        .bookshelf {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 24px;
        }
        .book {
            text-align: center;
            cursor: pointer;
        }
        .book-cover {
            height: 160px;
            background-color: var(--bg-light);
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .book:hover .book-cover {
            transform: translateY(-4px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        .book-cover svg {
            width: 48px;
            height: 48px;
            color: var(--text-secondary);
        }
        .book-title {
            font-size: 13px;
            font-weight: 500;
        }
    </style>
</head>
<body>

    <div class="app-wrapper">
        <nav class="main-nav">
            <div>
                <img src="images/cl-logo-white.svg" alt="Carnegie Learning Logo" class="logo">
                <select class="nav-dropdown">
                    <option>LiveHint AI Demo</option>
                </select>
                <ul class="nav-list">
                    <li><a href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z" /></svg> <span>Home</span></a></li>
                    <li><a href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M14 17H4V15H14V17M14 13H4V11H14V13M14 9H4V7H14V9M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3M19 19H5V5H19V19M16.5 15.5L15 14L16.5 12.5L18 14L16.5 15.5Z" /></svg> <span>My Assignments</span></a></li>
                    <li><a href="#" class="active"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.13,5.12L18.88,8.87M3,17.25V21H6.75L17.81,9.94L14.06,6.19L3,17.25Z" /></svg> <span>Writer's Workspace</span></a></li>
                    <li><a href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V4A2,2 0 0,0 18,2M18,20H6V4H18V20M12,6A4,4 0 0,1 16,10C16,11.39 15.19,12.57 14,12.9V13A1,1 0 0,1 13,14H11A1,1 0 0,1 10,13V12.9C8.81,12.57 8,11.39 8,10A4,4 0 0,1 12,6M12,8A2,2 0 0,0 10,10A2,2 0 0,0 12,12A2,2 0 0,0 14,10A2,2 0 0,0 12,8Z" /></svg> <span>Digital Books</span></a></li>
                </ul>
            </div>
            <div class="nav-footer">
                <ul class="nav-list">
                    <li><a href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M10,19H12V17H10V19M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z" /></svg> <span>Help & FAQ</span></a></li>
                    <li><a href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19,3H5C3.89,3 3,3.89 3,5V9H5V5H19V19H5V15H3V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M10.08,15.58L11.5,17L16.5,12L11.5,7L10.08,8.41L12.67,11H3V13H12.67L10.08,15.58Z" /></svg> <span>Back to Portal</span></a></li>
                    <li><a href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16,17V14H9V10H16V7L21,12L16,17M14,2A2,2 0 0,1 16,4V6H14V4H5V20H14V18H16V20A2,2 0 0,1 14,22H5A2,2 0 0,1 3,20V4A2,2 0 0,1 5,2H14Z" /></svg> <span>Logout</span></a></li>
                </ul>
                <div class="version-info">v2.97.3 / v2.97.2</div>
            </div>
        </nav>
        <main class="main-content">
            <div class="content-header">
                <h2>Writer's Workspace</h2>
                <input type="text" class="search-assignments" placeholder="Search...">
            </div>
            <div class="workspace-tabs">
                <button class="tab-btn" data-pane="library"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19,2H5A2,2 0 0,0 3,4V20A2,2 0 0,0 5,22H19A2,2 0 0,0 21,20V4A2,2 0 0,0 19,2M19,20H5V18H19V20M19,17H5V4H19V17Z" /></svg> <span>Library</span></button>
                <button class="tab-btn" data-pane="vocab-journal"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17,3H7A2,2 0 0,0 5,5V21L12,18L19,21V5C19,3.89 18.1,3 17,3Z" /></svg> <span>Vocabulary Journal</span></button>
                <button class="tab-btn" data-pane="artifacts"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20.54,5.23L19.15,3.55C18.88,3.21 18.47,3 18,3H6C5.47,3 5.06,3.21 4.78,3.55L3.39,5.23C3.13,5.53 3,5.96 3,6.4V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V6.4C21,5.96 20.87,5.53 20.61,5.23M19,19H5V7H19V19M11,10H13V12H11V10M11,13H13V15H11V13M15,10H17V12H15V10M15,13H17V15H15V13M7,10H9V15H7V10Z" /></svg> <span>Artifacts</span></button>
                <button class="tab-btn" data-pane="notebook"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17,2H7A2,2 0 0,0 5,4V20A2,2 0 0,0 7,22H17A2,2 0 0,0 19,20V4A2,2 0 0,0 17,2M17,20H7V4H17V20M12,18A1,1 0 0,1 11,17V11L8.5,13.5L7.08,12.08L12,7.16L16.92,12.08L15.5,13.5L13,11V17A1,1 0 0,1 12,18Z"/></svg> <span>Writer's Notebook</span></button>
                <button class="tab-btn" data-pane="driving-task"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M13,3.5L18.5,9H13V3.5M12,19L8,15H10.5V12H13.5V15H16L12,19Z" /></svg> <span>Driving Task</span></button>
            </div>
            <div class="workspace-container" id="workspace-container">
                <div class="workspace-pane" id="pane-1"></div>
                <div class="workspace-pane" id="pane-2"></div>
            </div>
        </main>
    </div>

    <div class="modal-overlay" id="library-modal">
        <div class="modal-container">
            <div class="modal-header">
                <h3>Select a Text from the Library</h3>
                <button class="modal-close-btn">&times;</button>
            </div>
            <div class="modal-content">
                <div class="bookshelf">
                    <!-- Books will be generated here -->
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const tabs = document.querySelectorAll('.tab-btn');
            const panes = [
                document.getElementById('pane-1'),
                document.getElementById('pane-2')
            ];
            const libraryModal = document.getElementById('library-modal');
            const workspaceContainer = document.getElementById('workspace-container');

            let activePanes = [null, null];

            // UPDATED PANE CONTENT FOR TINYMCE
            const paneContent = {
                library: { title: 'Library: The Medicine Bag', icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19,2H5A2,2 0 0,0 3,4V20A2,2 0 0,0 5,22H19A2,2 0 0,0 21,20V4A2,2 0 0,0 19,2M19,20H5V18H19V20M19,17H5V4H19V17Z" /></svg>', content: `<div class="pane-content"><div class="library-text-container"><h1>The Medicine Bag</h1><h2>by Virginia Driving Hawk Sneve</h2><p>My kid sister Cheryl and I always bragged about our Sioux grandpa, Joe Iron Shell. Our friends, who had always lived in the city and knew about Indians only from movies and TV, were impressed by our stories. Maybe we exaggerated and made Grandpa and the reservation sound glamorous, but when we’d return home to Iowa after our yearly summer visit to Grandpa, we always had some exciting tale to tell.</p><p><mark>We never showed our friends Grandpa’s picture.</mark> Not that we were ashamed of him, but because we knew that the glamorous tales we told didn’t go with the real thing. Our friends would have laughed at the picture because Grandpa wasn’t tall and stately like TV Indians. His hair wasn’t in braids but hung in stringy gray strands on his neck, and he was old. He was our great-grandfather, and he didn’t live in a tepee but all by himself in a part log, part tar-paper shack on the Rosebud Reservation in South Dakota. So when Grandpa came to visit us, <mark>I was so ashamed and embarrassed I could’ve died.</mark></p></div></div><div class="library-footer"><button id="open-bookshelf-btn">Choose Another Text...</button></div>` },
                'vocab-journal': { title: 'Vocabulary Journal', icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17,3H7A2,2 0 0,0 5,5V21L12,18L19,21V5C19,3.89 18.1,3 17,3Z" /></svg>', content: `<div class="placeholder-content">This area would display a list of words the student has saved from the Library,<br>along with their definitions and personal notes.</div>` },
                artifacts: { title: 'Artifacts', icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20.54,5.23L19.15,3.55C18.88,3.21 18.47,3 18,3H6C5.47,3 5.06,3.21 4.78,3.55L3.39,5.23C3.13,5.53 3,5.96 3,6.4V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V6.4C21,5.96 20.87,5.53 20.61,5.23M19,19H5V7H19V19M11,10H13V12H11V10M11,13H13V15H11V13M15,10H17V12H15V10M15,13H17V15H15V13M7,10H9V15H7V10Z" /></svg>', content: `<div class="placeholder-content">This area would show a collection of the student's completed graphic organizers<br>and other structured artifacts.</div>` },
                notebook: { title: "Writer's Notebook", icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17,2H7A2,2 0 0,0 5,4V20A2,2 0 0,0 7,22H17A2,2 0 0,0 19,20V4A2,2 0 0,0 17,2M17,20H7V4H17V20M12,18A1,1 0 0,1 11,17V11L8.5,13.5L7.08,12.08L12,7.16L16.92,12.08L15.5,13.5L13,11V17A1,1 0 0,1 12,18Z"/></svg>', content: `<div class="pane-content editor-pane"><textarea id="notebook-editor">This is the Writer's Notebook. It's a place for brainstorming, free writing, and keeping notes.</textarea></div>` },
                'driving-task': { title: 'Driving Task: Literary Analysis', icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M13,3.5L18.5,9H13V3.5M12,19L8,15H10.5V12H13.5V15H16L12,19Z" /></svg>', content: `<div class="pane-content editor-pane"><textarea id="driving-task-editor"><h1>Literary Analysis: The Weight of Heritage</h1><p>In Virginia Driving Hawk Sneve’s “The Medicine Bag,” the narrator, Martin, embarks on a reluctant journey from embarrassment to pride. His initial shame surrounding his grandfather is not born of malice, but of a youthful disconnect from his cultural heritage. This is evident when he admits, “I was so ashamed and embarrassed I could’ve died.” This powerful statement reveals the internal conflict between the glamorous stories he told his friends and the reality of his grandfather's appearance.</p><p>However, as the story progresses, Martin's perspective begins to shift. The turning point is not a single event, but a gradual understanding of the symbolism and history his grandfather carries...</p></textarea></div>` }
            };

            // TINYMCE INITIALIZATION LOGIC
            function initEditor(selector, height) {
                // First, check if an editor instance already exists and remove it.
                // This prevents errors when reopening a pane.
                if (tinymce.get(selector)) {
                    tinymce.remove(`#${selector}`);
                }
                
                tinymce.init({
                    selector: `#${selector}`,
                    height: height,
                    menubar: false,
                    plugins: 'lists link image table code help wordcount',
                    toolbar: 'undo redo | blocks | bold italic | alignleft aligncenter alignright | bullist numlist outdent indent | link image | code help',
                    content_style: 'body { font-family:Roboto,sans-serif; font-size:16px }'
                });
            }
            
            function renderPane(paneIndex, paneId) {
                const pane = panes[paneIndex];
                if (!paneId) {
                    pane.classList.add('hidden');
                    pane.innerHTML = '';
                    return;
                }
                const data = paneContent[paneId];
                pane.classList.remove('hidden');
                pane.innerHTML = `<div class="pane-header">${data.icon}<span>${data.title}</span></div>${data.content}`;

                // After rendering the pane, check if we need to initialize an editor
                if (paneId === 'notebook') {
                    // Use a timeout to ensure the DOM is fully ready
                    setTimeout(() => initEditor('notebook-editor', '100%'), 0);
                } else if (paneId === 'driving-task') {
                    setTimeout(() => initEditor('driving-task-editor', '100%'), 0);
                }
            }

            function updateUI() { 
                renderPane(0, activePanes[0]); 
                renderPane(1, activePanes[1]); 
                
                tabs.forEach(tab => { 
                    const paneId = tab.dataset.pane; 
                    if (activePanes.includes(paneId)) { 
                        tab.classList.add('active'); 
                    } else { 
                        tab.classList.remove('active'); 
                    }
                }); 
            }
            
            tabs.forEach(tab => {
                tab.addEventListener('click', (e) => {
                    const clickedPaneId = tab.dataset.pane;
                    
                    if (clickedPaneId === 'library') {
                        openLibraryModal();
                        return;
                    }

                    const activeIndex = activePanes.indexOf(clickedPaneId);

                    if (activeIndex > -1) {
                        activePanes[activeIndex] = null;
                    } else {
                        const emptySlotIndex = activePanes.indexOf(null);
                        if (emptySlotIndex > -1) {
                            activePanes[emptySlotIndex] = clickedPaneId;
                        } else {
                            activePanes[0] = clickedPaneId;
                        }
                    }
                    
                    const tabOrder = Array.from(tabs).map(t => t.dataset.pane);
                    activePanes.sort((a, b) => { if (a === null) return 1; if (b === null) return -1; return tabOrder.indexOf(a) - tabOrder.indexOf(b); });
                    updateUI();
                });
            });

            workspaceContainer.addEventListener('click', (e) => {
                if(e.target.closest('#open-bookshelf-btn')) {
                    openLibraryModal();
                }
            });

            function openLibraryModal() { libraryModal.style.display = 'flex'; }
            function closeLibraryModal() { libraryModal.style.display = 'none'; }
            libraryModal.querySelector('.modal-close-btn').addEventListener('click', closeLibraryModal);
            libraryModal.addEventListener('click', (e) => {
                if (e.target === libraryModal) {
                    closeLibraryModal();
                }
                const book = e.target.closest('.book');
                if (book) {
                    const title = book.dataset.title;
                    if (title === 'The Medicine Bag') {
                        // This logic is simplified for the demo: it always opens library in the first available pane.
                        const emptySlot = activePanes.indexOf(null);
                        if(emptySlot !== -1) {
                             activePanes[emptySlot] = 'library';
                        } else {
                             activePanes[0] = 'library';
                        }
                        const tabOrder = Array.from(tabs).map(t => t.dataset.pane);
                        activePanes.sort((a, b) => { if (a === null) return 1; if (b === null) return -1; return tabOrder.indexOf(a) - tabOrder.indexOf(b); });
                        closeLibraryModal();
                        updateUI();
                    } else {
                        alert(`Simulation: You clicked on "${title}". This text is not available in the demo.`);
                    }
                }
            });

            function renderBookshelf() {
                const bookshelf = libraryModal.querySelector('.bookshelf');
                const books = [
                    { title: "The Medicine Bag" },
                    { title: "The Tell-Tale Heart" },
                    { title: "The Raven" },
                    { title: "A Sound of Thunder" },
                    { title: "The Veldt" },
                ];
                bookshelf.innerHTML = books.map(book => `
                    <div class="book" data-title="${book.title}">
                        <div class="book-cover">
                             <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V4A2,2 0 0,0 18,2M18,20H6V4H18V20M12,6A4,4 0 0,1 16,10C16,11.39 15.19,12.57 14,12.9V13A1,1 0 0,1 13,14H11A1,1 0 0,1 10,13V12.9C8.81,12.57 8,11.39 8,10A4,4 0 0,1 12,6M12,8A2,2 0 0,0 10,10A2,2 0 0,0 12,12A2,2 0 0,0 14,10A2,2 0 0,0 12,8Z" /></svg>
                        </div>
                        <div class="book-title">${book.title}</div>
                    </div>
                `).join('');
            }
            
            // Initial state
            activePanes = ['library', 'driving-task'];
            updateUI();
            renderBookshelf();
        });
    </script>

</body>
</html>